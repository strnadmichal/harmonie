<!DOCTYPE html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chata Harmonie</title>

  <!-- Internal CSS styles -->
  <style>
    .reservation-form {
      max-width: 650px;
      margin: 0;
      padding: 20px 0;
    }

    .form-row {
      display: flex;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .form-column {
      flex: 1 0 315px;
      margin-bottom: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 24px;
      text-decoration: underline;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #000;
      border-radius: 0;
      background-color: transparent;
      box-sizing: border-box;
      outline: none;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 120px;
    }

    .captcha-button {
      background-color: #10162b;
      color: white;
      padding: 15px 20px;
      border: none;
      width: 100px;
      text-align: center;
      display: inline-block;
      cursor: pointer;
      margin-top: 10px;
    }

    .consent-group {
      display: flex;
      align-items: flex-start;
      margin: 30px 0;
    }

    .consent-group input[type="checkbox"] {
      margin-left: 10px;
      width: 30px;
      height: 30px;
      cursor: pointer;
      background-color: transparent;
      -webkit-appearance: none;
      appearance: none;
      border: 1px solid #000;
      position: relative;
      flex-shrink: 0;
    }
    
    .consent-group input[type="checkbox"]:checked::after {
      content: "✓";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
    }

    .submit-button {
      background-color: #10162b;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
      display: block;
    }

    .privacy-notice {
      margin: 15px 0;
    }
  </style>

  <link rel="stylesheet" href="../css/output.css" />
  <meta name="description" content="" />

  <meta property="og:title" content="" />
  <meta property="og:type" content="" />
  <meta property="og:url" content="" />
  <meta property="og:image" content="" />
  <meta property="og:image:alt" content="" />

  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" href="/icon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/icon.png" />

  <link rel="manifest" href="../site.webmanifest" />
  <meta name="theme-color" content="#fafafa" />
  <link rel="modulepreload" href="./components/header/header.js">
  <link rel="preload" href="./components/header/header.html" as="fetch" crossorigin>

  <!-- Google reCAPTCHA API -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <script src="./components/js/utils.js"></script>
  <script type="module">
    // Import the promise
    import { languageManagerReady } from "./js/languageManager.js";

    // This function will run AFTER the DOM is ready AND the language manager is initialized
    async function initializePage() {
        // Wait for components and language manager
        await Promise.all([
            loadComponent("header", "header"),
            loadComponent("footer", "footer"),
            languageManagerReady // Wait for the language manager to be ready
        ]);

        // Ensure languageManager is now available (it should be after awaiting)
        if (!window.languageManager || !window.languageManager.isInitialized) {
            console.error("Language manager failed to initialize properly!");
            return; // Stop further execution if manager failed
        }

        // Set header color based on page needs
        const header = document.querySelector("header");
        if (header) {
            header.setAttribute("data-header-color", "dark"); // or 'light'
        }
        
        // Logic for setting min dates
        setFormMinDates();

        // Display success message if redirected
        displaySubmissionStatus(); // This might need translation update

        // Initial content update for this specific page
        window.languageManager.updateContent();
    }

    // Function to display submission status message
    function displaySubmissionStatus() {
        const urlParams = new URLSearchParams(window.location.search);
        const submissionStatus = urlParams.get('submission');

        if (submissionStatus === 'success') {
            const formElement = document.getElementById('reservationForm');
            if (formElement) {
                const messageDiv = document.createElement('div');
                messageDiv.setAttribute('data-i18n', 'reservation.submission_success'); // Key for translation
                // Basic styling - you might want to use Tailwind classes or dedicated CSS
                messageDiv.style.padding = '15px';
                messageDiv.style.marginBottom = '20px';
                messageDiv.style.border = '1px solid green';
                messageDiv.style.backgroundColor = '#e8f5e9'; // Light green background
                messageDiv.style.color = 'darkgreen';
                messageDiv.textContent = 'Děkujeme za odeslání poptávky! Brzy se Vám ozveme.'; // Default text

                // Insert the message before the form
                formElement.parentNode.insertBefore(messageDiv, formElement);

                // Optional: Update content immediately if language manager is ready
                if (window.languageManager && window.languageManager.isInitialized) {
                     window.languageManager.updateElement(messageDiv);
                }
            }
        }
    }

    // Function to set minimum dates for date pickers
    function setFormMinDates() {
      const today = new Date().toISOString().split('T')[0];
      const arrivalInput = document.getElementById('arrival');
      const departureInput = document.getElementById('departure');
      
      if (arrivalInput) {
          arrivalInput.setAttribute('min', today);
          // Add event listener only if element exists
          arrivalInput.addEventListener('change', function() {
              if (departureInput) {
                  departureInput.setAttribute('min', this.value);
                  // If departure date is before new arrival date, update it
                  if (departureInput.value && departureInput.value < this.value) {
                      departureInput.value = this.value;
                  }
              }
          });
      }
      if (departureInput) {
          departureInput.setAttribute('min', today);
      }
    }

    // Run the initialization function when the DOM is ready
    document.addEventListener('DOMContentLoaded', initializePage);
  </script>

  <script>
    // This script block remains as it doesn't depend on languageManager and runs on DOMContentLoaded
    // Set min date for arrival and departure to today
    // NOTE: This logic is moved inside initializePage in the module script above for consistency.
    // This block can potentially be removed if the logic above works correctly.
    /*
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('arrival').setAttribute('min', today);
      document.getElementById('departure').setAttribute('min', today);
      
      // Update departure min date when arrival date changes
      document.getElementById('arrival').addEventListener('change', function() {
        document.getElementById('departure').setAttribute('min', this.value);
        
        // If departure date is before new arrival date, update it
        const departureInput = document.getElementById('departure');
        if (departureInput.value && departureInput.value < this.value) {
          departureInput.value = this.value;
        }
      });
    });
    */
  </script>
  <!--  <script src="../js/priceSheets.js" defer></script>-->
</head>

<body>
  <div id="header" data-page-theme="dark"></div>

  <main class="box-border px-4 md:px-10">
    <section class="mb-0 md:mb-20">
      <h2 class="mt-0 md:mt-6 mb-6 md:mb-10 text-3xl md:text-4xl" data-i18n="reservation.title">
        Rezervace
      </h2>

      <form 
        action="https://formsubmit.co/michalstrnad18@seznam.cz" 
        method="POST" 
        class="reservation-form" 
        id="reservationForm"
      >

        <input type="hidden" name="_subject" value="Nová rezervace">
        <input type="hidden" name="_next" value="https://harmonie-bedrichov.netlify.app/rezervace.html?submission=success">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_autoresponse" 
          value="Dobrý den, <br><br>
          děkujeme za Vaši poptávku rezervace v Chatě Harmonie. <br><br>
          Vaši poptávku zpracujeme a brzy se Vám ozveme s potvrzením dostupnosti a dalšími informacemi.
          <br><br>
          Dear Guest, <br><br>
          Thank you for your reservation inquiry at Chata Harmonie.<br><br>
          We will process your request and contact you soon with availability confirmation and further details."
        >

        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="firstname" data-i18n="reservation.firstname">Jméno</label>
              <input type="text" id="firstname" name="firstname" required />
            </div>
          </div>

          <div class="form-column">
            <div class="form-group">
              <label for="lastname" data-i18n="reservation.lastname">Příjmení</label>
              <input type="text" id="lastname" name="lastname" required />
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="phone" data-i18n="reservation.phone">Telefon</label>
              <input type="tel" id="phone" name="phone" required />
            </div>
          </div>

          <div class="form-column">
            <div class="form-group">
              <label for="email" data-i18n="reservation.email">Email</label>
              <input type="email" id="email" name="email" required />
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="adults" data-i18n="reservation.adults">Dospělí</label>
              <input type="number" id="adults" name="adults" value="0" min="0" required />
            </div>
          </div>

          <div class="form-column">
            <div class="form-group">
              <label for="children" data-i18n="reservation.children">Děti</label>
              <input type="number" id="children" name="children" value="0" min="0" />
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-column">
            <div class="form-group">
              <label for="arrival" data-i18n="reservation.arrival">Příjezd</label>
              <input type="date" id="arrival" name="arrival" required />
            </div>
          </div>

          <div class="form-column">
            <div class="form-group">
              <label for="departure" data-i18n="reservation.departure">Odjezd</label>
              <input type="date" id="departure" name="departure" required />
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="room" data-i18n="reservation.room">Pokoj</label>
          <select id="room" name="room" required>
            <option value="" disabled selected data-i18n="reservation.select_room">-- Vyberte pokoj --</option>
            <option value="1" data-i18n="rooms.room1">Pokoj č.1</option>
            <option value="2" data-i18n="rooms.room2">Pokoj č.2</option>
            <option value="3" data-i18n="rooms.room3">Pokoj č.3</option>
            <option value="4" data-i18n="rooms.room4">Pokoj č.4</option>
            <option value="5" data-i18n="rooms.room5">Pokoj č.5</option>
            <option value="6" data-i18n="rooms.room6">Pokoj č.6</option>
            <option value="7" data-i18n="rooms.room7">Pokoj č.7</option>
            <option value="apartment-67" data-i18n="rooms.apartment67">Apartmán 67</option>
            <option value="apartment-68" data-i18n="rooms.apartment68">Apartmán 68</option>
          </select>
        </div>

        <div class="form-group my-10">
          <label for="message" data-i18n="reservation.message">Vaše zpráva</label>
          <textarea id="message" name="message" rows="8"></textarea>
        </div>

        <div class="privacy-notice">
          <p>
            <span data-i18n="reservation.privacy_notice">Prosíme, přečtěte si naše</span>
            <a href="ochrana-osobnich-udaju.html" class="underline" data-i18n="reservation.privacy_policy">
              Prohlášení o ochraně osobních údajů</a>.
          </p>
        </div>

        <div class="consent-group text-base md:text-xl">
          <label for="consent" data-i18n="reservation.consent_text">
            Přečetl jsem si a souhlasím se zpracováním osobních údajů
          </label>
          <input type="checkbox" id="consent" name="consent" required />
          <span style="margin-left: 5px;">*</span>
        </div>

        <!-- <div class="g-recaptcha" data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"></div>
        <div class="captcha-error" style="color: red; margin-top: 10px; display: none;" data-i18n="reservation.captcha_error">Please complete the captcha</div> -->

        <button type="submit" class="submit-button text-2xl my-10 px-10 py-2" data-i18n="reservation.submit">
          Odeslat
        </button>
      </form>
    </section>

    <div id="footer"></div>
  </main>
</body>

</html>